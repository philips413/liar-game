<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#667eea">
    <title>라이어 게임</title>
    <link rel="stylesheet" href="/style.css?v=9">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.6.1/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
</head>
<body>
    <div id="app">
        <!-- 메인 화면 -->
        <div id="main-screen" class="screen">
            <div class="container">
                <h1 class="title">🎭 라이어 게임</h1>
                <div class="button-group">
                    <button id="create-room-btn" class="btn btn-primary">방 만들기</button>
                    <button id="join-room-btn" class="btn btn-secondary">방 참가하기</button>
                </div>
            </div>
        </div>

        <!-- 방 생성 화면 -->
        <div id="create-room-screen" class="screen hidden">
            <div class="container">
                <h2>방 만들기</h2>
                <form id="create-room-form">
                    <div class="form-group">
                        <label for="host-nickname">닉네임</label>
                        <input type="text" id="host-nickname" maxlength="20" required>
                    </div>
                    <div class="form-group">
                        <label for="max-players">최대 인원</label>
                        <select id="max-players">
                            <option value="3" selected>3명</option>
                            <option value="4">4명</option>
                            <option value="5">5명</option>
                            <option value="6">6명</option>
                            <option value="8">8명</option>
                            <option value="10">10명</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="round-limit">라운드 수</label>
                        <select id="round-limit">
                            <option value="1" selected>1라운드</option>
                            <option value="2" >2라운드</option>
                            <option value="3" >3라운드</option>
                        </select>
                    </div>
                    <div class="button-group">
                        <button type="submit" class="btn btn-primary">방 생성</button>
                        <button type="button" id="create-back-btn" class="btn btn-secondary">뒤로가기</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- 방 참가 화면 -->
        <div id="join-room-screen" class="screen hidden">
            <div class="container">
                <h2>방 참가하기</h2>
                <form id="join-room-form">
                    <div class="form-group">
                        <label for="room-code">방 코드</label>
                        <input type="text" id="room-code" maxlength="8" placeholder="방 코드를 입력하세요" required>
                    </div>
                    <div class="form-group">
                        <label for="player-nickname">닉네임</label>
                        <input type="text" id="player-nickname" maxlength="20" required>
                    </div>
                    <div class="button-group">
                        <button type="submit" class="btn btn-primary">참가하기</button>
                        <button type="button" id="join-back-btn" class="btn btn-secondary">뒤로가기</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- 간소화된 직접 참가 화면 -->
        <div id="direct-join-screen" class="screen hidden">
            <div class="container">
                <h2>🎭 라이어 게임 참가</h2>
                <div class="room-info-display">
                    <p class="join-message">초대받은 방에 참가합니다</p>
                    <div class="room-code-display">
                        <span class="label">방 코드:</span>
                        <span id="direct-room-code" class="room-code"></span>
                    </div>
                </div>
                <form id="direct-join-form">
                    <div class="form-group">
                        <label for="direct-player-nickname">닉네임을 입력하세요</label>
                        <input type="text" id="direct-player-nickname" maxlength="20" placeholder="닉네임" required autofocus>
                    </div>
                    <div class="button-group">
                        <button type="submit" class="btn btn-primary btn-large">게임 참가하기</button>
                        <button type="button" id="direct-join-cancel-btn" class="btn btn-secondary">취소</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- 대기실 화면 -->
        <div id="waiting-room-screen" class="screen hidden">
            <div class="container">
                <h2>대기실</h2>
                <div class="room-info">
                    <div class="room-code-section">
                        <p>방 코드: <span id="waiting-room-code" class="room-code"></span></p>
                        <div class="room-actions">
                            <button id="share-room-link-btn" class="btn btn-share" title="방 링크 공유">
                                🔗 링크 공유
                            </button>
                        </div>
                    </div>
                    <p>내 닉네임: <span id="my-nickname" class="nickname"></span></p>
                </div>

                <div class="players-section">
                    <h3>참가자 목록 (<span id="player-count">0</span>명)</h3>
                    <div id="players-list" class="players-list"></div>
                </div>
                <div class="button-group">
                    <button id="start-game-btn" class="btn btn-primary hidden">게임 시작</button>
                    <button id="leave-room-btn" class="btn btn-secondary">방 나가기</button>
                </div>
            </div>
        </div>

        <!-- 게임 화면 -->
        <div id="game-screen" class="screen hidden">
            <div class="container senior-friendly">
                <!-- 게임 상태 표시 -->
                <div class="game-status">
                    <div class="round-info">
                        <span id="current-round">1</span> / <span id="total-rounds">3</span> 라운드
                    </div>
                    <div class="phase-info" id="phase-info">대기 중...</div>
                </div>

                <!-- 내 정보 -->
                <div class="my-info">
                    <div class="my-nickname">나: <span id="game-my-nickname"></span></div>
                    <div class="my-role" id="my-role"></div>
                    <div class="my-word" id="my-word"></div>
                </div>

                <!-- 호스트 전용 컨트롤 패널 -->
                <div class="host-control-panel hidden" id="host-control-panel">
                    <div class="host-panel-header">
                        <h4>🎮 호스트 컨트롤</h4>
                    </div>
                    <div class="host-panel-content">
                        <div id="host-status-area" style="margin-bottom: 10px">
                            <!-- 게임 상태 메시지가 여기에 표시됩니다 -->
                        </div>
                        <div class="host-actions-area" id="host-actions-area">
                            <!-- 호스트 액션 버튼들이 여기에 표시됩니다 -->
                        </div>
                    </div>
                </div>

                <!-- 채팅창 (항상 표시) -->
                <div class="chat-container" id="game-chat-container">
                    <div class="chat-messages" id="chat-messages">
                        <!-- 채팅 메시지들이 여기에 표시됩니다 -->
                    </div>
                </div>

                <!-- 설명 입력 (항상 표시) -->
                <div class="description-input-section" id="permanent-description-input">
                    <div class="input-group inline-input">
                        <input type="text" id="description-input" placeholder="받은 단어에 대해 설명해주세요..." maxlength="200" />
                        <button id="submit-description-btn" class="btn btn-primary" style="height: 100%; min-height: 100%">단어 설명</button>
                    </div>
                </div>

                <!-- 설명 작성 단계 -->
                <div id="description-phase" class="game-phase hidden">
                </div>

                <!-- 투표 단계 -->
                <div id="voting-phase" class="game-phase hidden">
                    <h3>라이어를 찾아 투표하세요</h3>
                    <div id="voting-players" class="voting-grid"></div>
                </div>

                <!-- 최후진술 완료 -->
                <div id="final-defense-complete-phase" class="game-phase hidden">
                    <h3>최후진술이 완료되었습니다</h3>
                    <div class="final-defense-display">
                        <div class="accused-info">
                            <strong><span id="final-accused-name"></span>님의 최후진술:</strong>
                        </div>
                        <div class="final-defense-text" id="final-defense-text"></div>
                    </div>
                    <button id="start-final-voting-btn" class="btn btn-primary hidden">생존/사망 투표 시작</button>
                    <div class="waiting-message">호스트가 재투표를 시작하길 기다리는 중...</div>
                </div>

                <!-- 생존/사망 재투표 -->
                <div id="final-voting-phase" class="game-phase hidden">
                    <h3><span id="final-voting-player-name"></span>님에 대한 최종 투표</h3>
                    <div class="final-vote-options">
                        <button id="survive-vote-btn" class="vote-btn survive-btn">생존</button>
                        <button id="eliminate-vote-btn" class="vote-btn eliminate-btn">사망</button>
                    </div>
                </div>

                <!-- 라운드 종료 -->
                <div id="round-end-phase" class="game-phase hidden">
                    <h3>라운드가 종료되었습니다</h3>
                    <div id="round-result" class="round-result"></div>
                    <div id="host-round-controls" class="button-group hidden">
                        <button id="proceed-next-round-btn" class="btn btn-primary">다음 라운드 진행</button>
                    </div>
                    <div id="waiting-next-round" class="waiting-message">호스트가 다음 라운드를 시작하길 기다리는 중...</div>
                </div>

                <!-- 게임 종료 -->
                <div id="game-end-phase" class="game-phase hidden">
                    <h3 id="game-result-title">게임 종료</h3>
                    <div id="game-result-content">
                        <div class="result-info" id="winner-info"></div>
                        <div class="players-roles" id="players-roles"></div>
                    </div>
                    <div class="button-group">
                        <button id="new-game-btn" class="btn btn-primary">새 게임</button>
                        <button id="exit-game-btn" class="btn btn-secondary">나가기</button>
                    </div>
                </div>

                <!-- 플레이어 목록 (사이드바) -->
                <div class="players-sidebar">
                    <h4>플레이어 목록</h4>
                    <div id="game-players-list" class="game-players-list"></div>
                </div>
            </div>
        </div>

        <!-- 게임 시작 카운트다운 팝업 -->
        <div id="countdown-modal" class="modal-overlay hidden">
            <div class="modal-content countdown-modal">
                <h2>게임이 시작됩니다!</h2>
                <div class="countdown-circle">
                    <span id="countdown-number">5</span>
                </div>
                <p>모든 플레이어는 준비하세요!</p>
            </div>
        </div>

        <!-- 로딩 오버레이 -->
        <div id="loading-overlay" class="loading-overlay hidden">
            <div class="loading-spinner"></div>
            <div class="loading-text">처리 중...</div>
        </div>

        <!-- 토스트 알림 컨테이너 -->
        <div id="toast-container" class="toast-container">
            <!-- 토스트 알림들이 여기에 동적으로 추가됩니다 -->
        </div>

        <!-- 알림 팝업 (기존 유지, 중요한 알림용) -->
        <div id="notification-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-body">
                    <p id="notification-message"></p>
                </div>
                <div class="modal-footer">
                    <button id="notification-close-btn" class="btn btn-primary">확인</button>
                </div>
            </div>
        </div>

        <!-- 투표 결과 팝업 -->
        <div id="vote-result-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>투표 결과</h3>
                </div>
                <div class="modal-body">
                    <div id="vote-result-content"></div>
                </div>
                <div class="modal-footer">
                    <button id="vote-result-close-btn" class="btn btn-primary">확인</button>
                </div>
            </div>
        </div>

        <!-- 라이어 투표 팝업 -->
        <div id="voting-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>🗳️ 라이어 투표</h3>
                    <p>라이어라고 생각되는 플레이어를 선택해주세요</p>
                </div>
                <div class="modal-body">
                    <div id="voting-modal-players" class="voting-grid">
                        <!-- 투표할 플레이어 목록이 여기에 표시됩니다 -->
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="vote-status">투표할 플레이어를 선택해주세요</div>
                    <button id="close-voting-modal-btn" class="btn btn-secondary" onclick="closeVotingModal()">취소</button>
                </div>
            </div>
        </div>

        <!-- 최후진술 팝업 -->
        <div id="final-defense-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>🎭 최후진술</h3>
                    <p>지목되었습니다. 최후진술을 작성해주세요!</p>
                </div>
                <div class="modal-body">
                    <div class="input-group">
                        <textarea id="modal-final-defense-input" placeholder="최후진술을 작성해주세요..." maxlength="300"></textarea>
                        <div class="char-count"><span id="modal-final-char-count">0</span>/300</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="modal-submit-final-defense-btn" class="btn btn-primary">최후진술 완료</button>
                </div>
            </div>
        </div>

        <!-- 생존/사망 투표 팝업 -->
        <div id="final-voting-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>⚖️ 최종 심판</h3>
                    <p><span id="modal-accused-player-name"></span>님에 대한 최종 투표</p>
                </div>
                <div class="modal-body">
                    <div class="final-vote-description">
                        <p>최후진술을 들었습니다. 어떻게 결정하시겠습니까?</p>
                    </div>
                    <div class="final-vote-options">
                        <button id="modal-survive-vote-btn" class="vote-btn survive-btn" onclick="handleModalFinalVote('SURVIVE')">
                            <div class="vote-icon">🛡️</div>
                            <div class="vote-text">생존</div>
                            <div class="vote-desc">이 플레이어를 살려둡니다</div>
                        </button>
                        <button id="modal-eliminate-vote-btn" class="vote-btn eliminate-btn" onclick="handleModalFinalVote('ELIMINATE')">
                            <div class="vote-icon">⚔️</div>
                            <div class="vote-text">사망</div>
                            <div class="vote-desc">이 플레이어를 처형합니다</div>
                        </button>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="vote-status">선택해주세요</div>
                </div>
            </div>
        </div>

        <!-- 지목된 플레이어용 결과 대기 모달 -->
        <div id="waiting-result-modal" class="modal-overlay hidden">
            <div class="modal-content waiting-modal">
                <div class="modal-header">
                    <h3>⏳ 결과 대기중</h3>
                </div>
                <div class="modal-body">
                    <div class="waiting-content">
                        <div class="waiting-icon">
                            <div class="loading-spinner"></div>
                        </div>
                        <div class="waiting-message">
                            <p class="main-text">다른 플레이어들이 투표하고 있습니다</p>
                            <p class="sub-text">잠시만 기다려주세요...</p>
                        </div>
                        <div class="waiting-info">
                            <div class="info-item">
                                <span class="info-icon">👥</span>
                                <span class="info-text">다른 플레이어들이 당신의 운명을 결정합니다</span>
                            </div>
                            <div class="info-item">
                                <span class="info-icon">⚖️</span>
                                <span class="info-text">과반수가 결정하면 결과가 나옵니다</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 게임 종료 승리자 팝업 모달 -->
        <div id="game-winner-modal" class="modal-overlay hidden">
            <div class="modal-content winner-modal">
                <div class="modal-header winner-header">
                    <h2 id="winner-title">🎉 게임 종료</h2>
                </div>
                <div class="modal-body winner-body">
                    <div class="winner-content">
                        <div class="winner-icon" id="winner-icon">
                            🏆
                        </div>
                        <div class="winner-message" id="winner-message">
                            게임이 종료되었습니다!
                        </div>
                        <div class="winner-details" id="winner-details">
                        </div>
                        <div class="players-roles-reveal" id="players-roles-reveal">
                            <h4>🎭 역할 공개</h4>
                            <div class="roles-list" id="roles-list">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer winner-footer">
                    <div class="auto-redirect-info">
                        <span id="countdown-timer">10</span>초 후 자동으로 대기실로 이동합니다
                    </div>
                    <button id="winner-close-btn" class="modal-btn primary-btn" onclick="closeWinnerModal()">
                        확인 (바로 이동)
                    </button>
                </div>
            </div>
        </div>

        <!-- 최종 투표 결과 팝업 모달 -->
        <div id="final-result-modal" class="modal-overlay hidden">
            <div class="modal-content final-result-modal">
                <div class="modal-header final-result-header">
                    <h2 id="final-result-title">⚖️ 최종 투표 결과</h2>
                </div>
                <div class="modal-body final-result-body">
                    <div class="final-result-content">
                        <div class="result-icon" id="result-icon">
                            ⚖️
                        </div>
                        <div class="result-message" id="result-message">
                            투표 결과가 나왔습니다!
                        </div>
                        <div class="result-details" id="result-details">
                            최종 결정이 내려졌습니다.
                        </div>
                        <div class="next-action" id="next-action">
                            게임이 계속됩니다...
                        </div>
                    </div>
                </div>
                <div class="modal-footer final-result-footer">
                    <button id="final-result-close-btn" class="modal-btn primary-btn" onclick="closeFinalResultModal()">
                        확인
                    </button>
                </div>
            </div>
        </div>

        <!-- 사망한 플레이어용 검은 스크린 오버레이 -->
        <div id="dead-player-overlay" class="dead-player-overlay hidden">
            <div class="dead-player-content">
                <div class="dead-player-icon">💀</div>
                <div class="dead-player-title">게임에서 탈락하셨습니다</div>
                <div class="dead-player-message">
                    안타깝게도 이번 라운드에서 탈락하게 되었습니다.<br>
                    하지만 계속해서 게임을 관전할 수 있습니다.
                </div>
                <div class="dead-player-restriction">
                    사망한 플레이어는 더 이상 게임에 참여할 수 없습니다.<br>
                    투표, 설명 작성 등 모든 게임 활동이 제한됩니다.
                </div>
                <div class="dead-watching-info">
                    관전자로서 게임을 계속 지켜보실 수 있습니다.<br>
                    다른 플레이어들의 게임 진행을 지켜봐주세요!
                </div>
            </div>
        </div>
    </div>

    <script src="/game.js?v=1"></script>
    <script src="/ui.js?v=1"></script>
    <script src="/app.js?v=1"></script>
</body>
</html>